(()=>{"use strict";const t=document.getElementById("main"),e=document.getElementById("counter");var s;function i(t,e){return Math.floor(Math.random()*(e-t+1))+t}!function(t){t[t.Blank=0]="Blank",t[t.Mine=1]="Mine",t[t.FakeMine=2]="FakeMine",t[t.Magic=3]="Magic"}(s||(s={}));class n{isFlagged;type;revealed;constructor(t,e){this.isFlagged=t,this.type=e,this.revealed=!1}}class o{col;row;constructor(t,e){this.col=t,this.row=e}compare(t){return t.col==this.col&&t.row==this.row}}function l(t,e){for(const s of t)if(s.compare(e))return!0;return!1}function r(t){return t.col.toString()+"-"+t.row.toString()}function c(t){return new o(parseInt(t.split("-")[0]),parseInt(t.split("-")[1]))}class a{grid;flags;tilesLeft;gameEnded;fakeMines;mines;constructor(t){const e=[];this.flags=10,this.gameEnded=!1;for(let s=0;s<10;s++){let s;do{s=new o(i(0,11),i(0,11))}while(l(e,s)||s.compare(t));e.push(s)}this.mines=e,this.fakeMines=[];for(let t=0;t<5;t++){let t;do{t=new o(i(0,11),i(0,11))}while(l([...e,...this.fakeMines],t));this.fakeMines.push(t)}const r=[];for(let t=0;t<3;t++){let t;do{t=new o(i(0,11),i(0,11))}while(l([...e,...this.fakeMines,...r],t));r.push(t)}this.tilesLeft=134,this.grid=[];for(let t=0;t<12;t++){this.grid[t]=[];for(let e=0;e<12;e++)this.grid[t][e]=new n(!1,s.Blank)}for(const t of e)this.grid[t.col][t.row].type=s.Mine;for(const t of this.fakeMines)this.grid[t.col][t.row].type=s.FakeMine;for(const t of r)this.grid[t.col][t.row].type=s.Magic}isMine(t){return t===s.FakeMine||t===s.Mine}getNumMines(t){let e=0,s=t.row-1;s>-1&&this.isMine(this.grid[t.col][s].type)&&e++,s=t.row+1,s<12&&this.isMine(this.grid[t.col][s].type)&&e++,s=t.col-1,s>-1&&this.isMine(this.grid[s][t.row].type)&&e++,s=t.col+1,s<12&&this.isMine(this.grid[s][t.row].type)&&e++,s=t.row-1;let i=t.col-1;return s>-1&&i>-1&&this.isMine(this.grid[i][s].type)&&e++,s=t.row+1,i=t.col-1,s<12&&i>-1&&this.isMine(this.grid[i][s].type)&&e++,s=t.row-1,i=t.col+1,s>-1&&i<12&&this.isMine(this.grid[i][s].type)&&e++,s=t.row+1,i=t.col+1,s<12&&i<12&&this.isMine(this.grid[i][s].type)&&e++,e}newBtnClicked(t){const e=[];e.push(t);let n=!0;for(;0!==e.length;){const t=e.shift(),l=this.grid[t.col];if(void 0===l)continue;const c=l[t.row];if(void 0===c)continue;const a=document.getElementById(r(t));if(this.gameEnded||c.isFlagged)return;if(c.revealed)continue;if(c.type===s.Mine){document.getElementById("status").textContent="You lost! You clicked on a mine.";for(const t of this.mines)document.getElementById(r(t)).classList.add("mnsw-lost");return this.gameEnded=!0,void(document.getElementById("restart").style.display="block")}if(c.type===s.Magic&&!n)continue;c.type===s.Magic&&(this.shuffleMines(),a.classList.add("mnsw-magic")),c.revealed=!0,a.classList.add("mnsw-revealed"),this.tilesLeft--,a.disabled=!0;const d=this.getNumMines(t);if(a.textContent=0===d?"":d.toString(),0===d){let s=1/0,n=this.fakeMines[0];for(const e of this.fakeMines){const i=Math.abs(t.row-e.row)+Math.abs(t.col-e.col);i<s&&(s=i,n=e)}e.push(new o(t.col+1,t.row+1)),e.push(new o(t.col-1,t.row-1)),e.push(new o(t.col,t.row+1)),e.push(new o(t.col-1,t.row)),e.push(new o(t.col+1,t.row-1)),e.push(new o(t.col-1,t.row+1)),e.push(new o(t.col+1,t.row)),e.push(new o(t.col,t.row-1));const l=-(n.col-t.col)+i(0,2)-1,r=n.row-t.row+i(0,2)-1;l<0&&r<0?a.classList.add("mnsw-btn-both-negative"):a.classList.add("mnsw-btn-blank"),a.textContent=l<0?r.toString()+l.toString()+"i":r.toString()+"+"+l.toString()+"i"}else a.textContent=d.toString();0===this.tilesLeft&&(document.getElementById("status").textContent="You won! Congratulations.",this.gameEnded=!0),n=!1}}shuffleMines(){const t=[];for(const[e,i]of this.grid.entries())for(const[n,l]of i.entries())l.revealed||l.type===s.Magic||l.type===s.Mine||t.push(new o(e,n));for(const e of this.mines){if(0===t.length)break;const n=i(0,t.length-1),o=t[n];this.grid[e.col][e.row].type=s.Blank,this.grid[o.col][o.row].type=s.Mine,e.col=o.col,e.row=o.row,t.splice(n,1)}}getFlags(){return this.flags}useFlag(t){0!==this.flags&&(this.flags--,this.grid[t.col][t.row].isFlagged=!0,document.getElementById(r(t)).classList.add("mnsw-flagged"),e.textContent=`Flags left: ${this.flags}`)}removeFlag(t){this.grid[t.col][t.row].isFlagged=!1;const s=document.getElementById(r(t));s.textContent="",s.classList.remove("mnsw-flagged"),this.flags++,e.textContent=`Flags left: ${this.flags}`}toggleFlag(t){this.grid[t.col][t.row].revealed||this.gameEnded||(this.grid[t.col][t.row].isFlagged?this.removeFlag(t):this.useFlag(t))}}const d=(t,s)=>{if(s)d.game?.toggleFlag(c(t));else if(void 0===d.game){const s=parseInt(t.split("-")[0]),i=parseInt(t.split("-")[1]),n=new o(s,i);d.game=new a(n),e.textContent=`Flags left: ${d.game.getFlags()}`,d.game.newBtnClicked(c(t))}else d.game.newBtnClicked(c(t))};d.game=void 0;for(let e=0;e<12;e++)for(let s=0;s<12;s++){const i=document.createElement("button");i.id=e.toString()+"-"+s.toString(),i.className="mnsw-btn",i.addEventListener("click",(t=>{const e=t.target;d(e.id)})),i.addEventListener("contextmenu",(t=>{t.preventDefault();const e=t.target;d(e.id,!0)})),t.appendChild(i)}document.getElementById("restart").onclick=()=>{window.location.reload()},document.getElementById("tutorial").onclick=()=>{const t=document.getElementById("tut-container");"flex"===t.style.display?t.style.display="none":t.style.display="flex"},setInterval((()=>{d.game}),3e4)})();