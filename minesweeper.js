(()=>{"use strict";const t=document.getElementById("main"),e=document.getElementById("counter");var s;function i(t,e){return Math.floor(Math.random()*(e-t+1))+t}!function(t){t[t.Blank=0]="Blank",t[t.Mine=1]="Mine",t[t.FakeMine=2]="FakeMine",t[t.Magic=3]="Magic"}(s||(s={}));class n{isFlagged;type;revealed;constructor(t,e){this.isFlagged=t,this.type=e,this.revealed=!1}}class o{col;row;constructor(t,e){this.col=t,this.row=e}compare(t){return t.col==this.col&&t.row==this.row}}function l(t,e){for(const s of t)if(s.compare(e))return!0;return!1}function r(t){return t.col.toString()+"-"+t.row.toString()}function a(t){return new o(parseInt(t.split("-")[0]),parseInt(t.split("-")[1]))}class g{grid;flags;tilesLeft;gameEnded;fakeMines;mines;constructor(t){const e=[];this.flags=10,this.gameEnded=!1;for(let s=0;s<10;s++){let s;do{s=new o(i(0,11),i(0,11))}while(l(e,s)||s.compare(t));e.push(s)}this.mines=e,this.fakeMines=[];for(let t=0;t<5;t++){let t;do{t=new o(i(0,11),i(0,11))}while(l([...e,...this.fakeMines],t));this.fakeMines.push(t)}const r=[];for(let t=0;t<3;t++){let t;do{t=new o(i(0,11),i(0,11))}while(l([...e,...this.fakeMines,...r],t));r.push(t)}this.tilesLeft=134,this.grid=[];for(let t=0;t<12;t++){this.grid[t]=[];for(let e=0;e<12;e++)this.grid[t][e]=new n(!1,s.Blank)}for(const t of e)this.grid[t.col][t.row].type=s.Mine;for(const t of this.fakeMines)this.grid[t.col][t.row].type=s.FakeMine;for(const t of r)this.grid[t.col][t.row].type=s.Magic}isMine(t){return t===s.FakeMine||t===s.Mine}newBtnClicked(t){const e=this.grid[t.col][t.row],n=document.getElementById(r(t));if(this.gameEnded||e.isFlagged)return;if(e.type===s.Mine){document.getElementById("status").textContent="You lost! You clicked on a mine.";for(const t of this.mines)document.getElementById(r(t)).classList.add("mnsw-lost");return void(this.gameEnded=!0)}e.type===s.Magic&&(this.shuffleMines(),n.classList.add("mnsw-magic")),e.revealed=!0,n.classList.add("mnsw-revealed"),this.tilesLeft--,n.disabled=!0;let o=0,l=t.row-1;l>-1&&this.isMine(this.grid[t.col][l].type)&&o++,l=t.row+1,l<12&&this.isMine(this.grid[t.col][l].type)&&o++,l=t.col-1,l>-1&&this.isMine(this.grid[l][t.row].type)&&o++,l=t.col+1,l<12&&this.isMine(this.grid[l][t.row].type)&&o++,l=t.row-1;let a=t.col-1;if(l>-1&&a>-1&&this.isMine(this.grid[a][l].type)&&o++,l=t.row+1,a=t.col-1,l<12&&a>-1&&this.isMine(this.grid[a][l].type)&&o++,l=t.row-1,a=t.col+1,l>-1&&a<12&&this.isMine(this.grid[a][l].type)&&o++,l=t.row+1,a=t.col+1,l<12&&a<12&&this.isMine(this.grid[a][l].type)&&o++,n.textContent=0===o?"":o.toString(),0===o){let e=1/0,s=this.fakeMines[0];for(const i of this.fakeMines){const n=Math.abs(t.row-i.row)+Math.abs(t.col-i.col);n<e&&(e=n,s=i)}const o=-(s.col-t.col)+i(0,2)-1,l=s.row-t.row+i(0,2)-1;o<0&&l<0?n.classList.add("mnsw-btn-both-negative"):n.classList.add("mnsw-btn-blank"),n.textContent=l<0?o.toString()+l.toString()+"i":o.toString()+"+"+l.toString()+"i"}else n.textContent=o.toString();0===this.tilesLeft&&(document.getElementById("status").textContent="You won! Congratulations.",this.gameEnded=!0)}shuffleMines(){const t=[];for(const[e,i]of this.grid.entries())for(const[n,l]of i.entries())l.revealed||l.type===s.Magic||l.type===s.Mine||t.push(new o(e,n));for(const e of this.mines){if(0===t.length)break;const n=i(0,t.length-1),o=t[n];this.grid[e.col][e.row].type=s.Blank,this.grid[o.col][o.row].type=s.Mine,t.splice(n,1)}}getFlags(){return this.flags}useFlag(t){0!==this.flags&&(this.flags--,this.grid[t.col][t.row].isFlagged=!0,document.getElementById(r(t)).classList.add("mnsw-flagged"),e.textContent=`Flags left: ${this.flags}`)}removeFlag(t){this.grid[t.col][t.row].isFlagged=!1;const s=document.getElementById(r(t));s.textContent="",s.classList.remove("mnsw-flagged"),this.flags++,e.textContent=`Flags left: ${this.flags}`}toggleFlag(t){this.grid[t.col][t.row].revealed||this.gameEnded||(this.grid[t.col][t.row].isFlagged?this.removeFlag(t):this.useFlag(t))}}const c=(t,s)=>{if(s)c.game?.toggleFlag(a(t));else if(void 0===c.game){const s=parseInt(t.split("-")[0]),i=parseInt(t.split("-")[1]),n=new o(s,i);c.game=new g(n),e.textContent=`Flags left: ${c.game.getFlags()}`,c.game.newBtnClicked(a(t))}else c.game.newBtnClicked(a(t))};c.game=void 0;for(let e=0;e<12;e++)for(let s=0;s<12;s++){const i=document.createElement("button");i.id=e.toString()+"-"+s.toString(),i.className="mnsw-btn",i.addEventListener("click",(t=>{const e=t.target;c(e.id)})),i.addEventListener("contextmenu",(t=>{t.preventDefault();const e=t.target;c(e.id,!0)})),t.appendChild(i)}})();